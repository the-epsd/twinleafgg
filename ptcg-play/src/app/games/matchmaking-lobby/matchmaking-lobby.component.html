<div class="matchmaking-lobby" [class.format-selected]="selectedFormat && !isFormatAnimating"
  [class.format-hovered]="hoveredFormat"
  [class.format-standard]="selectedFormat === Format.STANDARD || hoveredFormat === Format.STANDARD"
  [class.format-standard-nightly]="selectedFormat === Format.STANDARD_NIGHTLY || hoveredFormat === Format.STANDARD_NIGHTLY"
  [style.--background-image]="getBackgroundImage()">
  <div class="lobby-content">
    <!-- Format Selection - Central Layout -->
    <div class="format-navigation-container">
      <!-- Previous Button -->
      <twinleaf-previous-button [disabled]="!canNavigatePrevious()" (clicked)="previousFormat()">
      </twinleaf-previous-button>

      <!-- Format Selection Container -->
      <div class="format-selection-container">
        <!-- Dynamic Format List -->
        <div class="format-box" *ngFor="let format of getVisibleFormats(); let i = index"
          [class.selected]="selectedFormat === format.value"
          [class.fade-on-hover]="selectedFormat && hoveredFormat && selectedFormat !== hoveredFormat && selectedFormat === format.value"
          [class.disabled]="inQueue || !hasValidDeckForFormat(format.value)"
          (click)="!inQueue && hasValidDeckForFormat(format.value) && onFormatSelected(format.value)"
          (mouseenter)="hasValidDeckForFormat(format.value) && onFormatHover(format.value)"
          (mouseleave)="onFormatHover(null)">
          <!-- Queue Count Overlay -->
          <div class="queue-overlay" *ngIf="getQueueCountForFormat(format.value) > 0">
            {{ getQueueCountForFormat(format.value) }} {{
            getQueueCountForFormat(format.value) === 1 ? 'player' : 'players' }} in queue
          </div>
          <div class="format-artwork">
            <div class="deck-archetype">
              <ptcg-archetype [class]="getArchetype(getDeckForFormat(format.value))"
                style="transform: scale(3); display: flex; image-rendering: pixelated;"></ptcg-archetype>
            </div>
          </div>
          <div class="format-info">
            <div class="format-name">{{ getFormatLabel(format.value) | translate }}</div>
            <div class="deck-name">{{ getDeckForFormat(format.value)?.name || 'NO_DECK' | translate }}
            </div>
          </div>
        </div>
      </div>

      <!-- Next Button -->
      <twinleaf-next-button [disabled]="!canNavigateNext()" (clicked)="nextFormat()">
      </twinleaf-next-button>
    </div>

    <!-- Connection Status -->
    <div *ngIf="connectionError" class="connection-error">
      <mat-icon>error_outline</mat-icon> Connection error
    </div>

    <!-- Play Button -->
    <twinleaf-play-button [text]="(!selectedFormat ? 'SELECT_FORMAT' : 'BUTTON_FIND_MATCH') | translate"
      [inQueue]="inQueue" [loading]="loading" [disabled]="!deckId || !selectedFormat" [onCooldown]="onCooldown"
      [cooldownSeconds]="cooldownSeconds" [connectionError]="connectionError"
      (clicked)="inQueue ? leaveQueue() : joinQueue()">
    </twinleaf-play-button>
  </div>
</div>