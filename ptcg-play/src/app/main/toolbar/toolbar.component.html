<div class="gaming-toolbar" [class.menu-open]="menuOpen">
  <!-- Mobile Overlay -->
  <div class="mobile-overlay" *ngIf="menuOpen" (click)="closeMenu()"></div>

  <!-- Mobile Side Menu -->
  <div class="mobile-side-menu" [class.menu-open]="menuOpen" *ngIf="loggedUser">
    <div class="sidebar-header">
      <span class="sidebar-title">Menu</span>
      <button class="close-sidebar" (click)="closeMenu()" mat-icon-button>
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="sidebar-content">
      <a class="sidebar-menu-item" routerLink="/games" routerLinkActive="active" (click)="closeMenu()">
        {{ 'MAIN_GAMES' | translate }}
      </a>
      <a class="sidebar-menu-item" routerLink="/deck" routerLinkActive="active" (click)="closeMenu()">
        {{ 'MAIN_DECKS' | translate }}
      </a>
      <a class="sidebar-menu-item" routerLink="/spectate" routerLinkActive="active" (click)="closeMenu()">
        SPECTATE
      </a>
      <a class="sidebar-menu-item" routerLink="/replays" routerLinkActive="active" (click)="closeMenu()">
        {{ 'MAIN_REPLAYS' | translate }}
      </a>
      <a class="sidebar-menu-item" routerLink="/friends" routerLinkActive="active" (click)="closeMenu()"
        *ngIf="isAdmin$ | async">
        FRIENDS
      </a>
      <a class="sidebar-menu-item" routerLink="/ranking" routerLinkActive="active" (click)="closeMenu()">
        {{ 'MAIN_RANKING' | translate }}
      </a>
      <a class="sidebar-menu-item" routerLink="/message" routerLinkActive="active" (click)="closeMenu()">
        {{ 'MAIN_MESSAGES' | translate }}
      </a>
      <a class="sidebar-menu-item battle-pass-item" routerLink="/battle-pass" routerLinkActive="active"
        (click)="closeMenu()" *ngIf="isAdmin$ | async">
        BATTLE PASS
      </a>
      <div class="sidebar-menu-item tables-item" *ngIf="(gameStates$ | async)?.length > 0">
        <button mat-button [matMenuTriggerFor]="gamesMenu" class="tables-menu-button">
          {{ 'MAIN_TABLES' | translate }}
          <mat-icon>arrow_drop_down</mat-icon>
          <span *ngIf="hasTableNotifications$ | async" class="notification-badge"
            [matBadge]="tableBadgeContent$ | async" [matBadgeColor]="tableBadgeColor$ | async"
            matBadgeOverlap="false"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Left Section - Hamburger Menu Button (Mobile) -->
  <div class="toolbar-left-mobile">
    <button mat-icon-button class="mobile-menu-button" (click)="toggleMenu()" *ngIf="loggedUser">
      <mat-icon>menu</mat-icon>
    </button>
  </div>

  <!-- Left Section - Logo -->
  <div class="toolbar-left">
    <div class="logo-section">
      <img src="/assets/tl-open-beta-sm.webp" alt="Twinleaf" class="twinleaf-logo">
    </div>
  </div>

  <!-- Center Section - Main Navigation -->
  <div class="toolbar-center">
    <!-- Desktop Navigation -->
    <nav class="main-navigation">
      <a routerLink="/games" class="nav-item" routerLinkActive="active" *ngIf="loggedUser">
        <span class="nav-text">{{ 'MAIN_GAMES' | translate }}</span>
      </a>
      <a routerLink="/deck" class="nav-item" routerLinkActive="active" *ngIf="loggedUser">
        <span class="nav-text">{{ 'MAIN_DECKS' | translate }}</span>
      </a>
      <a routerLink="/spectate" class="nav-item" routerLinkActive="active" *ngIf="loggedUser">
        <span class="nav-text">SPECTATE</span>
      </a>
      <a routerLink="/replays" class="nav-item" routerLinkActive="active" *ngIf="loggedUser">
        <span class="nav-text">{{ 'MAIN_REPLAYS' | translate }}</span>
      </a>
      <!-- <a routerLink="/friends" class="nav-item" routerLinkActive="active" *ngIf="loggedUser && (isAdmin$ | async)">
        <span class="nav-text">FRIENDS</span>
      </a> -->
      <a routerLink="/ranking" class="nav-item" routerLinkActive="active" *ngIf="loggedUser">
        <span class="nav-text">{{ 'MAIN_RANKING' | translate }}</span>
      </a>
      <a routerLink="/message" class="nav-item" routerLinkActive="active" *ngIf="loggedUser">
        <span class="nav-text">{{ 'MAIN_MESSAGES' | translate }}</span>
      </a>
      <a routerLink="/battle-pass" class="nav-item battle-pass-item" routerLinkActive="active"
        *ngIf="loggedUser && (isAdmin$ | async)">
        <span class="nav-text">BATTLE PASS</span>
      </a>

      <!-- Tables Menu Button - Centered between Battle Pass and User Info -->
      <button mat-button [matMenuTriggerFor]="gamesMenu" class="nav-item tables-item"
        *ngIf="loggedUser && (gameStates$ | async)?.length > 0">
        <span class="nav-text">{{ 'MAIN_TABLES' | translate }}</span>
        <mat-icon>arrow_drop_down</mat-icon>
        <span *ngIf="hasTableNotifications$ | async" class="notification-badge" [matBadge]="tableBadgeContent$ | async"
          [matBadgeColor]="tableBadgeColor$ | async" matBadgeOverlap="false"></span>
      </button>
    </nav>
  </div>

  <span class="epsd-spacer"></span>

  <!-- Connection status indicator -->
  <ptcg-connection-status *ngIf="loggedUser"></ptcg-connection-status>

  <mat-menu #gamesMenu="matMenu">
    <a mat-menu-item *ngFor="let gameState of (gameStates$ | async)" [routerLink]="['/table', gameState.localId]">
      <ptcg-sidenav-item [gameState]="gameState"></ptcg-sidenav-item>
    </a>
  </mat-menu>

  <!-- Right Section - User Resources and Profile -->
  <div class="toolbar-right">
    <!-- Language select - shown when not logged in -->
    <ptcg-language-select *ngIf="!loggedUser"></ptcg-language-select>

    <div class="ptcg-toolbar-user-info">
      <ptcg-user-bar *ngIf="loggedUser" class="ptcg-logged-user" [openUserPopup]="false" [user]="loggedUser"
        [matMenuTriggerFor]="menu">
      </ptcg-user-bar>

      <mat-menu #menu="matMenu" class="user-menu">
        <button mat-menu-item [routerLink]="['/profile', loggedUser?.userId]">
          {{ 'BUTTON_SHOW_PROFILE' | translate }}
        </button>
        <button mat-menu-item (click)="openSettingsDialog()">
          {{ 'BUTTON_SETTINGS' | translate }}
        </button>
        <button mat-menu-item (click)="logout()">
          {{ 'BUTTON_LOGOUT' | translate }}
        </button>
      </mat-menu>
    </div>
  </div>
</div>