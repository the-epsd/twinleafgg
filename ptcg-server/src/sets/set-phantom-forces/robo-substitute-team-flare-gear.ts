// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { TrainerCard } from '../../game/store/card/trainer-card';
import { CardType, PokemonType, Stage, SuperType, TrainerType } from '../../game/store/card/card-types';
import { GameError, GameMessage, Power, PowerType, PokemonCard, PokemonCardList, StoreLike, State, StateUtils } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { KnockOutEffect, PowerEffect, RetreatEffect } from '../../game/store/effects/game-effects';
import { PlayItemEffect, PlayPokemonEffect } from '../../game/store/effects/play-card-effects';

// Ref: set-phantom-forces/robo-substitutue.ts (Robo Substitute - existing implementation)
export class RoboSubstituteTeamFlareGear extends TrainerCard {
  public trainerType: TrainerType = TrainerType.ITEM;
  public superType = SuperType.TRAINER;

  public stage: Stage = Stage.BASIC;
  public cardType: CardType = CardType.COLORLESS;
  public pokemonType = PokemonType.NORMAL;
  public evolvesFrom = '';
  public cardTag = [];
  public tools = [];
  public evolvesTo = [];
  public evolvesToStage = [];
  public archetype = [];
  public hp: number = 30;
  public weakness = [];
  public retreat = [];
  public resistance = [];
  public attacks = [];
  public attacksThisTurn: number = 0;
  public maxAttacksThisTurn: number = 1;
  public allowSubsequentAttackChoice: boolean = false;
  public maxTools: number = 1;
  public movedToActiveThisTurn = false;

  public set: string = 'PHF';
  public setNumber: string = '102';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Robo Substitute';
  public fullName: string = 'Robo Substitute Team Flare Gear PHF';
  public text: string = 'Play this card as if it were a 30 HP Colorless Basic Pokémon. At any time during your turn (before your attack), you may discard this card from play. This card can\'t retreat. If this card is Knocked Out, your opponent can\'t take any Prize Cards for it.';

  public powers: Power[] = [
    {
      name: 'Robo Substitute',
      text: 'Play this card as if it were a 30 HP [C] Basic Pokémon. At any time during your turn (before your attack), you may discard this card from play. This card can\'t retreat. If this card is Knocked Out, your opponent can\'t take any Prize cards for it.',
      useWhenInPlay: true,
      exemptFromAbilityLock: true,
      powerType: PowerType.TRAINER_ABILITY
    }
  ];

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Ability: Discard from play when activated
    if (effect instanceof PowerEffect && effect.power === this.powers[0]) {
      const cardList = StateUtils.findCardList(state, this) as PokemonCardList;
      const player = effect.player;

      if (player.bench.every(b => b.cards.length === 0)) {
        // If no bench Pokemon, move cards to deck (game will end)
        effect.player.active.moveCardsTo(effect.player.active.cards, player.deck);
      } else {
        player.switchPokemon(cardList);
        const pokeDollCardList = StateUtils.findCardList(state, this);
        pokeDollCardList.moveCardsTo(pokeDollCardList.cards, effect.player.discard);
      }
    }

    // Play from hand as a Pokemon
    if (effect instanceof PlayItemEffect && effect.trainerCard === this) {
      const player = effect.player;

      const emptySlots = player.bench.filter(b => b.cards.length === 0);
      if (emptySlots.length === 0) {
        throw new GameError(GameMessage.CANNOT_PLAY_THIS_CARD);
      }

      const playPokemonEffect = new PlayPokemonEffect(player, this as unknown as PokemonCard, emptySlots[0]);
      store.reduceEffect(state, playPokemonEffect);
    }

    // Cannot retreat
    if (effect instanceof RetreatEffect && effect.player.active.cards.includes(this)) {
      throw new GameError(GameMessage.CANNOT_RETREAT);
    }

    // No prize cards on KO
    if (effect instanceof KnockOutEffect && effect.target.cards.includes(this)) {
      effect.prizeCount = 0;
      return state;
    }

    return state;
  }
}
