// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { TrainerCard } from '../../game/store/card/trainer-card';
import { TrainerType, CardType, CardTag } from '../../game/store/card/card-types';
import { GameError, GameMessage, StoreLike, State, StateUtils } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { MoveCardsEffect, UseStadiumEffect } from '../../game/store/effects/game-effects';
import { CheckAttackCostEffect, CheckPokemonTypeEffect } from '../../game/store/effects/check-effects';

export class ThunderMountain extends TrainerCard {
  public trainerType: TrainerType = TrainerType.STADIUM;
  public tags = [CardTag.PRISM_STAR];
  public set: string = 'LOT';
  public setNumber: string = '191';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Thunder Mountain \u25C7';
  public fullName: string = 'Thunder Mountain \u25C7 LOT';
  public text: string = 'The attacks of Lightning Pok\u00e9mon (both yours and your opponent\'s) cost Lightning less. Whenever any player plays an Item or Supporter card from their hand, prevent all effects of that card done to this Stadium card. \u25C7 (Prism Star) Rule: You can\'t have more than 1 \u25C7 card with the same name in your deck. If a \u25C7 card would go to the discard pile, put it in the Lost Zone instead.';

  // Ref: set-lost-thunder/thunder-mountain-prism-star.ts (same card, duplicate implementation)
  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    if (effect instanceof CheckAttackCostEffect && StateUtils.getStadiumCard(state) === this) {
      const player = effect.player;
      const index = effect.cost.indexOf(CardType.LIGHTNING);

      if (index === -1) {
        return state;
      }

      const checkPokemonTypeEffect = new CheckPokemonTypeEffect(player.active);
      store.reduceEffect(state, checkPokemonTypeEffect);

      if (checkPokemonTypeEffect.cardTypes.includes(CardType.LIGHTNING)) {
        effect.cost.splice(index, 1);
      }

      return state;
    }

    if (effect instanceof UseStadiumEffect && StateUtils.getStadiumCard(state) === this) {
      throw new GameError(GameMessage.CANNOT_USE_STADIUM);
    }

    // Prevent effects of Item and Supporter cards on this Stadium
    if (effect instanceof MoveCardsEffect
      && StateUtils.getStadiumCard(state) === this) {

      if (effect.sourceCard instanceof TrainerCard &&
        (effect.sourceCard.trainerType === TrainerType.SUPPORTER || effect.sourceCard.trainerType === TrainerType.ITEM)) {

        const stadiumCard = StateUtils.getStadiumCard(state);
        if (stadiumCard !== undefined) {
          const cardList = StateUtils.findCardList(state, stadiumCard);
          if (effect.source === cardList) {
            effect.preventDefault = true;
          }
        }
      }
    }

    return state;
  }
}
