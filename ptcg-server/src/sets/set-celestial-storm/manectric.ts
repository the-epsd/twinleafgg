// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { PokemonCard } from '../../game/store/card/pokemon-card';
import { Stage, CardType, EnergyType, SuperType } from '../../game/store/card/card-types';
import { PowerType, StoreLike, State, StateUtils, EnergyCard, PlayerType, SlotType, GameMessage } from '../../game';
import { AttachEnergyPrompt } from '../../game/store/prompts/attach-energy-prompt';
import { Effect } from '../../game/store/effects/effect';
import { WAS_ATTACK_USED } from '../../game/store/prefabs/prefabs';

export class Manectric extends PokemonCard {
  public stage: Stage = Stage.STAGE_1;
  public evolvesFrom: string = 'Electrike';
  public cardType: CardType = L;
  public hp: number = 110;
  public weakness = [{ type: F }];
  public resistance = [{ type: M, value: -20 }];
  public retreat = [];

  public powers = [{
    name: 'Electric Start',
    powerType: PowerType.ABILITY,
    text: 'If you go second, and if this Pokémon is in your hand when you are setting up to play, you may put it face down as your Active Pokémon or on your Bench.'
  }];

  public attacks = [
    {
      name: 'Double Charge',
      cost: [L],
      damage: 40,
      text: 'You may attach up to 2 basic Energy cards from your hand to 1 of your Benched Pokémon.'
    }
  ];

  public set: string = 'CES';
  public setNumber: string = '52';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Manectric';
  public fullName: string = 'Manectric CES';

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Ability: Electric Start
    // TODO: "If you go second" setup-phase ability is not currently implementable
    // as the engine's PLAY_DURING_SETUP tag doesn't support conditional (going-second only) setup play.

    // Attack 1: Double Charge
    // Ref: set-celestial-storm/torkoal.ts (Flaming Honk - AttachEnergyPrompt pattern)
    if (WAS_ATTACK_USED(effect, 0, this)) {
      const player = effect.player;

      const hasBasicEnergy = player.hand.cards.some(c =>
        c instanceof EnergyCard && c.energyType === EnergyType.BASIC
      );
      const hasBench = player.bench.some(b => b.cards.length > 0);

      if (!hasBasicEnergy || !hasBench) {
        return state;
      }

      return store.prompt(state, new AttachEnergyPrompt(
        player.id,
        GameMessage.ATTACH_ENERGY_CARDS,
        player.hand,
        PlayerType.BOTTOM_PLAYER,
        [SlotType.BENCH],
        { superType: SuperType.ENERGY, energyType: EnergyType.BASIC },
        { allowCancel: false, min: 0, max: 2, sameTarget: true }
      ), transfers => {
        transfers = transfers || [];
        for (const transfer of transfers) {
          const target = StateUtils.getTarget(state, player, transfer.to);
          player.hand.moveCardTo(transfer.card, target);
        }
      });
    }

    return state;
  }
}
